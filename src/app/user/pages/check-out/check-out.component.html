<p-toast />
<div class="main">
  <h2 class="count">{{ giftboxCount }} &nbsp;items are selected</h2>
  <div class="detail">
    <ng-container *ngIf="giftBoxitems.length > 0; else emptyCart">
      <div *ngFor="let item of giftBoxitems" class="giftBox-card">
        <div class="gift-image">
          <img
            [src]="item.image"
            alt="{{ item.name }}"
            height="70px"
            class="clickable-image"
            (click)="openImagePreview(item.image, $event)"
          />
        </div>
        <div class="gift-info">
          <h4 class="gift-name">[#{{ item.id }}] &nbsp; {{ item.name }}</h4>
          <div class="gift-price">{{ item.unitPrice | currency:'LKR':'symbol':'1.2-2' }} Ã— {{ item.quantity }}</div>
        </div>
        <div class="quantity-controls">
          <p-button
            icon="pi pi-minus"
            [rounded]="true"
            [outlined]="true"
            (onClick)="shoppingCartService.decrementQuantity(item.id)"
            [disabled]="item.quantity <= 1"
          ></p-button>
          <span class="quantity">{{ item.quantity }}</span>
          <p-button
            icon="pi pi-plus"
            [rounded]="true"
            [outlined]="true"
            (onClick)="shoppingCartService.incrementQuantity(item.id)"
          ></p-button>
        </div>
        <p-button
          icon="pi pi-times"
          [rounded]="true"
          severity="danger"
          [outlined]="true"
          (onClick)="removeItemFromArray(item.id)"
          pTooltip="Remove Item"
          tooltipPosition="top"
        ></p-button>
      </div>
    </ng-container>
    
    <ng-template #emptyCart>
      <div class="empty-cart">
        <i class="pi pi-shopping-cart"></i>
        <h3>Your cart is empty</h3>
        <p>Browse our item catalog to add items to your cart</p>
        <p-button label="Browse Items" routerLink="/items"></p-button>
      </div>
    </ng-template>
  </div>
  
  <!-- Modal for image preview -->
  <div *ngIf="showModal" class="modal" (click)="closeModal()">
    <span class="close">&times;</span>
    <img class="modal-content" [src]="previewImage" alt="Image Preview" />
  </div>
  
  <div class="receiver-details">
    <h3>Delivery Information</h3>
    <div class="card flex flex-column gap-3">
      <p-iconField iconPosition="left" class="inptField">
        <p-inputIcon styleClass="pi pi-map-marker" />
        <input 
          type="text" 
          pInputText 
          placeholder="Address*" 
          [(ngModel)]="address" 
          [ngClass]="{'ng-invalid ng-dirty': submitted && !address}"
        />
      </p-iconField>
      <small *ngIf="submitted && !address" class="error-message">Address is required</small>
      
      <p-iconField iconPosition="left" class="inptField">
        <p-inputIcon styleClass="pi pi-circle-on" />
        <input 
          type="text" 
          pInputText 
          placeholder="Zip code*" 
          [(ngModel)]="zip"
          [ngClass]="{'ng-invalid ng-dirty': submitted && !zip}"
        />
      </p-iconField>
      <small *ngIf="submitted && !zip" class="error-message">Zip code is required</small>
    </div>
  </div>
  
  <div class="check-out">
    <div class="plan-card">
      <h2>Pay here <span>www.EMart.lk</span></h2>
      <div class="etiquet-price">
        <p>{{ totalPrice | number:'1.2-2' }}</p>
        <div></div>
      </div>
      <div class="benefits-list">
        <ul>
          <li>
            <svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M243.8 339.8C232.9 350.7 215.1 350.7 204.2 339.8L140.2 275.8C129.3 264.9 129.3 247.1 140.2 236.2C151.1 225.3 168.9 225.3 179.8 236.2L224 280.4L332.2 172.2C343.1 161.3 360.9 161.3 371.8 172.2C382.7 183.1 382.7 200.9 371.8 211.8L243.8 339.8zM512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256zM256 48C141.1 48 48 141.1 48 256C48 370.9 141.1 464 256 464C370.9 464 464 370.9 464 256C464 141.1 370.9 48 256 48z"
              ></path></svg>
              <span>Fast Shipping</span>
          </li>
          <li>
            <svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M243.8 339.8C232.9 350.7 215.1 350.7 204.2 339.8L140.2 275.8C129.3 264.9 129.3 247.1 140.2 236.2C151.1 225.3 168.9 225.3 179.8 236.2L224 280.4L332.2 172.2C343.1 161.3 360.9 161.3 371.8 172.2C382.7 183.1 382.7 200.9 371.8 211.8L243.8 339.8zM512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256zM256 48C141.1 48 48 141.1 48 256C48 370.9 141.1 464 256 464C370.9 464 464 370.9 464 256C464 141.1 370.9 48 256 48z"
              ></path></svg><span>Secure Packaging</span>
          </li>
          <li>
            <svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M243.8 339.8C232.9 350.7 215.1 350.7 204.2 339.8L140.2 275.8C129.3 264.9 129.3 247.1 140.2 236.2C151.1 225.3 168.9 225.3 179.8 236.2L224 280.4L332.2 172.2C343.1 161.3 360.9 161.3 371.8 172.2C382.7 183.1 382.7 200.9 371.8 211.8L243.8 339.8zM512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256zM256 48C141.1 48 48 141.1 48 256C48 370.9 141.1 464 256 464C370.9 464 464 370.9 464 256C464 141.1 370.9 48 256 48z"
              ></path></svg><span>Personalized</span>
          </li>
        </ul>
      </div>
      <div class="button-get-plan btnBg1">
        <a (click)="checkOut()" [class.disabled]="isLoading || giftBoxitems.length === 0">
          <span>
            <i *ngIf="isLoading" class="pi pi-spin pi-spinner"></i>
            <ng-container *ngIf="!isLoading">Place order</ng-container>
          </span>
        </a>
      </div>
      <div class="button-get-plan btnBg2">
        <a (click)="saveGift()" [class.disabled]="isLoading || giftBoxitems.length === 0">
          <span>
            <i *ngIf="isLoading" class="pi pi-spin pi-spinner"></i>
            <ng-container *ngIf="!isLoading">Save order</ng-container>
          </span>
        </a>
      </div>
    </div>
  </div>
</div>