
<div class="bg-white rounded-lg shadow-lg p-6">
  <div class="mb-6">
    <nav class="flex" aria-label="Breadcrumb">
      <p-breadcrumb class="max-w-full" [model]="category" [home]="home" />
    </nav>
  </div>
  
  <div class="bg-white rounded-lg overflow-hidden border border-gray-100">
    <p-tabView styleClass="custom-tabs">
      <p-tabPanel header="Categories">
        <div class="py-6">
          <p-accordion class="w-full custom-accordion" expandIcon="pi pi-plus" collapseIcon="pi pi-minus">
            <!-- Sub Category Dialog -->
            <p-dialog 
              [header]="isSubUpdate ? 'Update Sub Category' : 'Add New Sub Category'"
              [modal]="true"
              [(visible)]="subModelVisible"
              [(visible)]="isSubUpdate"
              [style]="{ width: '36rem' }"
              styleClass="custom-dialog"
              [breakpoints]="{'960px': '75vw', '640px': '90vw'}"
              [draggable]="false"
              [resizable]="false"
            >
              <ng-template pTemplate="header">
                <div class="flex items-center">
                  <i class="pi pi-folder-open text-blue-500 mr-2"></i>
                  <span>{{ isSubUpdate ? 'Update Sub Category' : 'Add New Sub Category' }}</span>
                </div>
              </ng-template>
              
              <div class="p-2">
                <p class="text-gray-500 mb-6 border-l-4 border-blue-500 pl-3 py-1 bg-blue-50 rounded">Please fill in the category details below.</p>
                
                <form [formGroup]="subCategoryForm" class="space-y-6">
                  <div class="form-group">
                    <label for="category" class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                    <div class="relative">
                      <i class="pi pi-list absolute left-3 top-3 text-gray-400"></i>
                      <select 
                        id="category" 
                        formControlName="category" 
                        required
                        class="w-full p-3 pl-10 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 transition-all"
                      >
                        <option value="" disabled selected>Select a category</option>
                        <option *ngFor="let category of fetchingCategories" [value]="category.id">
                          {{ category.name }}
                        </option>
                      </select>
                    </div>
                    <div *ngIf="subCategoryForm.get('category')?.invalid && subCategoryForm.get('category')?.touched"
                      class="mt-1 text-sm text-red-600">
                      <i class="pi pi-exclamation-circle mr-1"></i>Category is required.
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <label for="name" class="block text-sm font-medium text-gray-700 mb-2">Category Name</label>
                    <div class="relative">
                      <i class="pi pi-tag absolute left-3 top-3 text-gray-400"></i>
                      <input
                        pInputText
                        id="name"
                        formControlName="name"
                        required
                        autocomplete="off"
                        placeholder="Enter category name"
                        class="w-full p-3 pl-10 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 transition-all"
                      />
                    </div>
                    <div *ngIf="subCategoryForm.get('name')?.invalid && subCategoryForm.get('name')?.touched"
                      class="mt-1 text-sm text-red-600">
                      <i class="pi pi-exclamation-circle mr-1"></i>Name is required.
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <label for="dis" class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                    <div class="relative">
                      <i class="pi pi-align-left absolute left-3 top-3 text-gray-400"></i>
                      <input
                        pInputText
                        id="dis"
                        formControlName="description"
                        required
                        autocomplete="off"
                        placeholder="Enter description"
                        class="w-full p-3 pl-10 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 transition-all"
                      />
                    </div>
                    <div *ngIf="subCategoryForm.get('description')?.invalid && subCategoryForm.get('description')?.touched"
                      class="mt-1 text-sm text-red-600">
                      <i class="pi pi-exclamation-circle mr-1"></i>Description is required.
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <label for="image" class="block text-sm font-medium text-gray-700 mb-2">Image</label>
                    <div class="relative border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:bg-gray-50 transition-all">
                      <input
                        type="file"
                        id="image"
                        formControlName="image"
                        required
                        (change)="onFileSelected($event)"
                        class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                      />
                      <i class="pi pi-image text-3xl text-gray-400 mb-2"></i>
                      <p class="text-sm text-gray-500">Drag and drop your image here or click to browse</p>
                      <p class="text-xs text-gray-400 mt-1">Supported formats: JPG, PNG, GIF (Max: 5MB)</p>
                    </div>
                    <div
                      *ngIf="subCategoryForm.get('image')?.invalid && subCategoryForm.get('image')?.touched"
                      class="mt-1 text-sm text-red-600"
                    >
                      <i class="pi pi-exclamation-circle mr-1"></i>Image is required.
                    </div>
                  </div>
                </form>
              </div>
              
              <ng-template pTemplate="footer">
                <div class="flex justify-end space-x-3">
                  <p-button
                    label="Cancel"
                    severity="secondary"
                    (click)="subModelVisible = false; isSubUpdate = false"
                    styleClass="p-button-outlined custom-button"
                    icon="pi pi-times"
                  ></p-button>
                  <p-button
                    *ngIf="isSubUpdate"
                    label="Update"
                    (click)="updateSubCategory()"
                    [disabled]="subCategoryForm.invalid"
                    styleClass="custom-button-primary"
                    icon="pi pi-check"
                  ></p-button>
                  <p-button
                    *ngIf="!isSubUpdate"
                    label="Save"
                    (click)="addSubCategory()"
                    [disabled]="subCategoryForm.invalid"
                    styleClass="custom-button-primary"
                    icon="pi pi-save"
                  ></p-button>
                </div>
              </ng-template>
            </p-dialog>
            
            <div class="bg-white rounded-lg shadow-sm border border-gray-200">
              <div class="flex flex-col md:flex-row justify-between items-center p-4 border-b border-gray-200 bg-gray-50">
                <h1 class="text-xl font-semibold text-gray-800 mb-4 md:mb-0 flex items-center">
                  <i class="pi pi-list text-blue-500 mr-2"></i>
                  Sub Category List
                </h1>
                <div class="flex flex-wrap items-center gap-2">
                  <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                      <i class="pi pi-search text-gray-400"></i>
                    </span>
                    <input 
                      type="text" 
                      pInputText 
                      placeholder="Search categories" 
                      class="pl-10 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                    />
                  </div>
                  <p-button
                    icon="pi pi-refresh"
                    (onClick)="fetchSubAllCategories()"
                    styleClass="p-button-rounded p-button-outlined custom-button-refresh"
                    pTooltip="Refresh data"
                    tooltipPosition="top"
                    class="ml-2"
                  ></p-button>
                  <p-button
                    (click)="showSubCategoryDialog(); subCategoryForm.reset()"
                    label="Add Category"
                    icon="pi pi-plus"
                    styleClass="p-button-primary custom-button-primary"
                    class="ml-2"
                  ></p-button>
                </div>
              </div>
              
              <div class="overflow-x-auto">
                <table class="w-full text-sm text-left text-gray-500">
                  <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                    <tr>
                      <th class="px-6 py-3">ID</th>
                      <th class="px-6 py-3">Name</th>
                      <th class="px-6 py-3">Description</th>
                      <th class="px-6 py-3">Status</th>
                      <th class="px-6 py-3">Category ID</th>
                      <th class="px-6 py-3">Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let subCategory of fetchingSubCategories; let i = index" 
                        [ngClass]="{'bg-gray-50': i % 2 === 0}" 
                        class="border-b hover:bg-blue-50 transition-all">
                      <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">{{ subCategory.id }}</td>
                      <td class="px-6 py-4">{{ subCategory.name }}</td>
                      <td class="px-6 py-4">{{ subCategory.description }}</td>
                      <td class="px-6 py-4">
                        <span [ngClass]="{
                          'bg-green-100 text-green-800 border border-green-300': subCategory.commonStatus === 'ACTIVE',
                          'bg-red-100 text-red-800 border border-red-300': subCategory.commonStatus === 'INACTIVE'
                        }" class="px-2 py-1 rounded-full text-xs font-medium">
                          <i [ngClass]="{
                            'pi pi-check-circle mr-1': subCategory.commonStatus === 'ACTIVE',
                            'pi pi-times-circle mr-1': subCategory.commonStatus === 'INACTIVE'
                          }"></i>
                          {{ subCategory.commonStatus }}
                        </span>
                      </td>
                      <td class="px-6 py-4">{{ subCategory.categoryId }}</td>
                      <td class="px-6 py-4 flex gap-2">
                        <p-button
                          icon="pi pi-file-edit"
                          [text]="true"
                          [raised]="true"
                          (onClick)="fetchSubCategory(subCategory.id)"
                          styleClass="p-button-rounded p-button-info custom-button-edit"
                          pTooltip="Edit"
                          tooltipPosition="top"
                        ></p-button>
                        <p-button
                          icon="pi pi-trash"
                          [text]="true"
                          [raised]="true"
                          severity="danger"
                          (onClick)="deleteSubCategory(subCategory.id)"
                          styleClass="p-button-rounded custom-button-delete"
                          pTooltip="Delete"
                          tooltipPosition="top"
                        ></p-button>
                      </td>
                    </tr>
                    <tr *ngIf="fetchingSubCategories.length === 0">
                      <td colspan="6" class="px-6 py-8 text-center text-gray-500">
                        <i class="pi pi-info-circle text-3xl mb-2 text-gray-300"></i>
                        <p>No sub categories found. Click "Add Category" to create one.</p>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </p-accordion>
        </div>
      </p-tabPanel>
      
      <p-tabPanel header="Main Categories">
        <div class="py-6">
          <p-accordion class="w-full custom-accordion" expandIcon="pi pi-plus" collapseIcon="pi pi-minus">
            <!-- Main Category Dialog -->
            <p-dialog
              [header]="isUpdate ? 'Update Category' : 'Add New Category'"
              [modal]="true"
              [(visible)]="visible"
              [(visible)]="isUpdate"
              [style]="{ width: '36rem' }"
              styleClass="custom-dialog"
              [breakpoints]="{'960px': '75vw', '640px': '90vw'}"
              [draggable]="false"
              [resizable]="false"
            >
              <ng-template pTemplate="header">
                <div class="flex items-center">
                  <i class="pi pi-folder text-blue-500 mr-2"></i>
                  <span>{{ isUpdate ? 'Update Category' : 'Add New Category' }}</span>
                </div>
              </ng-template>
              
              <div class="p-2">
                <p class="text-gray-500 mb-6 border-l-4 border-blue-500 pl-3 py-1 bg-blue-50 rounded">Please fill in the category details below.</p>
                
                <form [formGroup]="categoryForm" class="space-y-6">
                  <div class="form-group">
                    <label for="name" class="block text-sm font-medium text-gray-700 mb-2">Category Name</label>
                    <div class="relative">
                      <i class="pi pi-tag absolute left-3 top-3 text-gray-400"></i>
                      <input
                        pInputText
                        id="name"
                        formControlName="name"
                        required
                        autocomplete="off"
                        placeholder="Enter category name"
                        class="w-full p-3 pl-10 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 transition-all"
                      />
                    </div>
                    <div *ngIf="categoryForm.get('name')?.invalid && categoryForm.get('name')?.touched"
                      class="mt-1 text-sm text-red-600">
                      <i class="pi pi-exclamation-circle mr-1"></i>Name is required.
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <label for="dis" class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                    <div class="relative">
                      <i class="pi pi-align-left absolute left-3 top-3 text-gray-400"></i>
                      <input
                        pInputText
                        id="dis"
                        formControlName="description"
                        required
                        autocomplete="off"
                        placeholder="Enter description"
                        class="w-full p-3 pl-10 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 transition-all"
                      />
                    </div>
                    <div *ngIf="categoryForm.get('description')?.invalid && categoryForm.get('description')?.touched"
                      class="mt-1 text-sm text-red-600">
                      <i class="pi pi-exclamation-circle mr-1"></i>Description is required.
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <label for="image" class="block text-sm font-medium text-gray-700 mb-2">Image</label>
                    <div class="relative border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:bg-gray-50 transition-all">
                      <input
                        type="file"
                        id="image"
                        formControlName="image"
                        required
                        (change)="onFileSelected($event)"
                        class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                      />
                      <i class="pi pi-image text-3xl text-gray-400 mb-2"></i>
                      <p class="text-sm text-gray-500">Drag and drop your image here or click to browse</p>
                      <p class="text-xs text-gray-400 mt-1">Supported formats: JPG, PNG, GIF (Max: 5MB)</p>
                    </div>
                    <div
                      *ngIf="categoryForm.get('image')?.invalid && categoryForm.get('image')?.touched"
                      class="mt-1 text-sm text-red-600"
                    >
                      <i class="pi pi-exclamation-circle mr-1"></i>Image is required.
                    </div>
                  </div>
                </form>
              </div>
              
              <ng-template pTemplate="footer">
                <div class="flex justify-end space-x-3">
                  <p-button
                    label="Cancel"
                    severity="secondary"
                    (click)="visible = false; isUpdate = false"
                    styleClass="p-button-outlined custom-button"
                    icon="pi pi-times"
                  ></p-button>
                  <p-button
                    *ngIf="isUpdate"
                    label="Update"
                    (click)="updateCategory()"
                    [disabled]="categoryForm.invalid"
                    styleClass="custom-button-primary"
                    icon="pi pi-check"
                  ></p-button>
                  <p-button
                    *ngIf="!isUpdate"
                    label="Save"
                    (click)="addCategory()"
                    [disabled]="categoryForm.invalid"
                    styleClass="custom-button-primary"
                    icon="pi pi-save"
                  ></p-button>
                </div>
              </ng-template>
            </p-dialog>
            
            <div class="bg-white rounded-lg shadow-sm border border-gray-200">
              <div class="flex flex-col md:flex-row justify-between items-center p-4 border-b border-gray-200 bg-gray-50">
                <h1 class="text-xl font-semibold text-gray-800 mb-4 md:mb-0 flex items-center">
                  <i class="pi pi-folder text-blue-500 mr-2"></i>
                  Category List
                </h1>
                <div class="flex flex-wrap items-center gap-2">
                  <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                      <i class="pi pi-search text-gray-400"></i>
                    </span>
                    <input 
                      type="text" 
                      pInputText 
                      placeholder="Search categories" 
                      class="pl-10 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                    />
                  </div>
                  <p-button
                    icon="pi pi-refresh"
                    (onClick)="fetchAllCategories()"
                    styleClass="p-button-rounded p-button-outlined custom-button-refresh"
                    pTooltip="Refresh data"
                    tooltipPosition="top"
                    class="ml-2"
                  ></p-button>
                  <p-button
                    (click)="showDialog(); categoryForm.reset()"
                    label="Add Category"
                    icon="pi pi-plus"
                    styleClass="p-button-primary custom-button-primary"
                    class="ml-2"
                  ></p-button>
                </div>
              </div>
              
              <div class="overflow-x-auto">
                <table class="w-full text-sm text-left text-gray-500">
                  <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                    <tr>
                      <th class="px-6 py-3">ID</th>
                      <th class="px-6 py-3">Name</th>
                      <th class="px-6 py-3">Description</th>
                      <th class="px-6 py-3">Status</th>
                      <th class="px-6 py-3">Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let category of fetchingCategories; let i = index" 
                        [ngClass]="{'bg-gray-50': i % 2 === 0}" 
                        class="border-b hover:bg-blue-50 transition-all">
                      <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">{{ category.id }}</td>
                      <td class="px-6 py-4">{{ category.name }}</td>
                      <td class="px-6 py-4">{{ category.description }}</td>
                      <td class="px-6 py-4">
                        <span [ngClass]="{
                          'bg-green-100 text-green-800 border border-green-300': category.commonStatus === 'ACTIVE',
                          'bg-red-100 text-red-800 border border-red-300': category.commonStatus === 'INACTIVE'
                        }" class="px-2 py-1 rounded-full text-xs font-medium">
                          <i [ngClass]="{
                            'pi pi-check-circle mr-1': category.commonStatus === 'ACTIVE',
                            'pi pi-times-circle mr-1': category.commonStatus === 'INACTIVE'
                          }"></i>
                          {{ category.commonStatus }}
                        </span>
                      </td>
                      <td class="px-6 py-4 flex gap-2">
                        <p-button
                          icon="pi pi-file-edit"
                          [text]="true"
                          [raised]="true"
                          (onClick)="fetchCategory(category.id)"
                          styleClass="p-button-rounded p-button-info custom-button-edit"
                          pTooltip="Edit"
                          tooltipPosition="top"
                        ></p-button>
                        <p-button
                          icon="pi pi-trash"
                          [text]="true"
                          [raised]="true"
                          severity="danger"
                          (onClick)="deleteCategory(category.id)"
                          styleClass="p-button-rounded custom-button-delete"
                          pTooltip="Delete"
                          tooltipPosition="top"
                        ></p-button>
                      </td>
                    </tr>
                    <tr *ngIf="fetchingCategories.length === 0">
                      <td colspan="5" class="px-6 py-8 text-center text-gray-500">
                        <i class="pi pi-info-circle text-3xl mb-2 text-gray-300"></i>
                        <p>No categories found. Click "Add Category" to create one.</p>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </p-accordion>
        </div>
      </p-tabPanel>
    </p-tabView>
  </div>
</div>